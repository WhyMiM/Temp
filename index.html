<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temp</title>
<style>
  body::-webkit-scrollbar {width: 10px; background-color: transparent; box-shadow: inset 1px 0px 0px 0px #00000029}
  body::-webkit-scrollbar-thumb {border-radius: 0px; border: none; background-color: #bababa}
  body::-webkit-scrollbar-thumb:hover {background-color: #afafaf}
  body::-webkit-scrollbar-thumb:active {background-color: #9d9d9}
  body {
    margin: 0;
    background-color: #222;
    font-family: Arial, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .page {flex: 1; display: flex; flex-direction: column; justify-content: space-between;}
  header, footer {width: 100%; background-color: #333; color: #fff; text-align: center;}
  footer {margin-top: auto; padding: 1rem 0;}

  /* BEFORE/AFTER SLIDER */
  .ba-slider {
    position: relative;
    display: flex;
    width: 100%;
    overflow: hidden;
    cursor: pointer;
    user-select: none;
    margin: 0;
    justify-content: center;
    align-items: center;
    background-color: #111;
  }

  .slider-group {overflow: hidden; height: 0;}
  .slider-group .ba-slider:not(:last-child) {border-bottom: 2px solid #5f5f5f}

  .img-wrapper {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .img-wrapper:nth-child(2) {clip-path: inset(0px 0px 0px 50%);}

  .img-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .line {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 2;
  }

  .handle {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 2.25rem;
    width: 2.25rem;
    background-color: rgba(55,55,55,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.4);
    border-radius: 50%;
    box-shadow: inset 0 10px 20px rgba(255,255,255,0.6), 0 8px 20px rgba(0,0,0,0.4);
    z-index: 3;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .handle::before,
  .handle::after {
    content: '';
    display: block;
    width: 8px;
    height: 8px;
    border-top: 4px solid rgba(255,255,255,0.5);
    border-right: 4px solid rgba(255,255,255,0.5);
    border-radius: 2px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .handle::before {transform: rotate(-135deg);}
  .handle::after {transform: rotate(45deg);}

  input {display: none;}

details {
    display: block;
    margin: 1rem 1rem;
    max-width: 100%; /* initial max-width */
    background-color: RGB(50,50,50);
    border: 2px solid #5f5f5f;
    border-radius: 6px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    transform-origin: center;
    color: #fff;
}

  #sliderSpoiler {
    user-select: none;
    cursor: pointer;
    color: #fff;
    font-weight: bold;
    text-align: center;
    padding: 8px 0px;
    background-color: rgba(55,55,55,0.2);
    backdrop-filter: blur(10px);
    border-radius: 4px;
    box-shadow: inset 0 10px 20px rgba(255,255,255,0.3),0 8px 20px rgba(0,0,0,0.4);
    transition: all 0.1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    width: 100%;
    box-sizing: border-box;
  }

  #sliderSpoiler:hover {
    background-color: rgba(55,55,55,0.3);
    box-shadow:inset 0 12px 22px rgba(255,255,255,0.4), 0 10px 25px rgba(0,0,0,0.4);
  }

  #sliderSpoiler:active {
    box-shadow:inset 0 10px 20px rgba(255,255,255,0.3);
  }

  details[open] #sliderSpoiler {border-bottom-left-radius: 0; border-bottom-right-radius: 0}
  #sliderSpoiler::-webkit-details-marker {display: none;}
  #sliderSpoiler::marker {content: none;}
  .slider-group {
    transform-origin: top;
    will-change: transform, opacity;
    transition: none;
  }

  .handle, .line {
    will-change: transform;
  }
</style>
</head>
<body>

<div class="page">
  <header><h1></h1></header>

  <details>
    <summary id="sliderSpoiler">Show more</summary>
    <div class="slider-group">
      <div class="ba-slider" data-before="https://picsum.photos/id/1015/800/600" data-after="https://picsum.photos/id/1016/800/600"></div>
      <div class="ba-slider" data-before="https://picsum.photos/id/1020/800/600" data-after="https://picsum.photos/id/1021/800/600"></div>
      <div class="ba-slider" data-before="https://picsum.photos/id/1025/800/600" data-after="https://picsum.photos/id/4/800/600"></div>
    </div>
  </details>

  <footer><p></p><p></p></footer>
</div>

<script>
const sliderClickSpeed = 0.2, sliderDragSpeed = 0.5;
const spoilerWidthSpeed = 0.2, spoilerHeightSpeed = 0.5;

/* BEFORE/AFTER SLIDER */
class BeforeAfterSlider {
  constructor(container) {
    this.container = container;
    const beforeURL = container.dataset.before, afterURL = container.dataset.after;

    this.container.innerHTML = `
      <div class="img-wrapper"><img src="${beforeURL}" alt="Before"></div>
      <div class="img-wrapper"><img src="${afterURL}" alt="After"></div>
      <div class="line"></div><div class="handle"></div>
    `;

    this.handle = container.querySelector('.handle');
    this.line = container.querySelector('.line');
    this.imgAfter = container.querySelector('.img-wrapper:nth-of-type(2)');
    this.imgBefore = container.querySelector('.img-wrapper:nth-of-type(1) img');
    this.imgAfterImg = this.imgAfter.querySelector('img');

    this.targetValue = 50;
    this.currentValue = this.targetValue;
    this.isDragging = false;
    this.mouseDown = false;

    // Wait until images are loaded to set aspect ratio
    const setAspectRatio = () => {
      const w = this.imgBefore.naturalWidth;
      const h = this.imgBefore.naturalHeight;
      if (w && h) this.container.style.aspectRatio = `${w} / ${h}`;
    };
    if (this.imgBefore.complete) setAspectRatio();
    else this.imgBefore.onload = setAspectRatio;

    this.addEventListeners();
    this.updateVisuals();
  }

  addEventListeners() {
    let dragDelayTimeout;
    this.container.addEventListener('mousedown', (e) => {
      if (e.button !== 0) return;
      e.preventDefault();
      const rect = this.container.getBoundingClientRect();
      let percent = ((e.clientX - rect.left) / rect.width) * 100;
      this.targetValue = Math.max(0, Math.min(100, percent));
      this.isDragging = false;
      this.mouseDown = true;
      clearTimeout(dragDelayTimeout);
      dragDelayTimeout = setTimeout(() => this.mouseDown && (this.isDragging = true), 150);
    });
    window.addEventListener('mouseup', () => {this.mouseDown = false; clearTimeout(dragDelayTimeout); this.isDragging = false});
    window.addEventListener('mousemove', (e) => {
      if (!this.mouseDown) return;
      const rect = this.container.getBoundingClientRect();
      let percent = ((e.clientX - rect.left) / rect.width) * 100;
      this.targetValue = Math.max(0, Math.min(100, percent));
    });
  }

  updateVisuals() {
      const speed = this.isDragging ? sliderDragSpeed : sliderClickSpeed;
      this.currentValue += (this.targetValue - this.currentValue) * speed;
      this.line.style.left = `${this.currentValue}%`;
      this.handle.style.left = `${this.currentValue}%`;
      this.imgAfter.style.clipPath = `inset(0px 0px 0px ${this.currentValue}%)`;
      requestAnimationFrame(() => this.updateVisuals());
  }
}

document.querySelectorAll('.ba-slider').forEach(slider => new BeforeAfterSlider(slider));








document.querySelectorAll('details').forEach(detail => {
  const content = detail.querySelector('.slider-group');
  const sliderSpoiler = detail.querySelector('#sliderSpoiler');
  if (!content || !sliderSpoiler) return;

  let animating = false;
  const easeInOutCubic = t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
  const animate = (duration, draw) => new Promise(resolve => {
    const start = performance.now();
    const step = time => {
      const progress = Math.min((time - start) / duration, 1);
      draw(easeInOutCubic(progress));
      if (progress < 1) requestAnimationFrame(step);
      else resolve();
    };
    requestAnimationFrame(step);
  });

  const getMaxImageWidth = () => {
    const images = detail.querySelectorAll('.ba-slider img');
    let maxWidth = 0;
    images.forEach(img => {
      if (img.naturalWidth > maxWidth) maxWidth = img.naturalWidth;
    });
    return maxWidth;
  };

  const updateOpenStyles = () => {
    if (!detail.open) return;
    const vw = window.innerWidth;
    const maxImageWidth = getMaxImageWidth();
    const width = Math.min(0.9 * vw, maxImageWidth);
    detail.style.width = width + 'px';
  };

  // Clone the sliderSpoiler to create a bottom collapse button
  let bottomCollapse = sliderSpoiler.cloneNode(true);
  bottomCollapse.textContent = 'Collapse';
  bottomCollapse.style.borderRadius = '0px';
  bottomCollapse.addEventListener('click', e => {
    e.preventDefault();
    if (!animating) sliderSpoiler.click(); // trigger collapse
  });

  // Initialize states
  if (detail.open) {
    updateOpenStyles();
    sliderSpoiler.textContent = 'Collapse';
    content.style.height = content.scrollHeight + 'px';
    detail.style.borderBottomLeftRadius = '0px';
    detail.style.borderBottomRightRadius = '0px';
    if (!content.contains(bottomCollapse)) content.appendChild(bottomCollapse);
  } else {
    sliderSpoiler.textContent = 'Show more';
    detail.style.width = '120px';
    content.style.height = '0px';
    detail.style.borderBottomLeftRadius = '8px';
    detail.style.borderBottomRightRadius = '8px';
    if (content.contains(bottomCollapse)) content.removeChild(bottomCollapse);
  }

  sliderSpoiler.addEventListener('click', async e => {
    e.preventDefault();
    if (animating) return;
    animating = true;

    const startWidth = detail.offsetWidth;
    const startMargin = parseFloat(getComputedStyle(detail).marginLeft);
    const vw = window.innerWidth;
    const maxImageWidth = getMaxImageWidth();
    const targetWidth = Math.min(0.9 * vw, maxImageWidth);
    const targetMargin = 0.05 * vw;

    if (detail.open) {
      const startHeight = content.scrollHeight;
      await animate(spoilerHeightSpeed * 1000, t => content.style.height = (startHeight * (1 - t)) + 'px');
      await animate(spoilerWidthSpeed * 1000, t => {
        detail.style.width = startWidth + (120 - startWidth) * t + 'px';
        detail.style.marginLeft = startMargin + (16 - startMargin) * t + 'px';
        detail.style.marginRight = startMargin + (16 - startMargin) * t + 'px';
        detail.style.borderBottomLeftRadius = `${8 * t}px`;
        detail.style.borderBottomRightRadius = `${8 * t}px`;
      });
      detail.open = false;
      sliderSpoiler.textContent = 'Show more';
      if (content.contains(bottomCollapse)) content.removeChild(bottomCollapse);
    } else {
      detail.open = true;
      sliderSpoiler.textContent = 'Collapse';
      await animate(spoilerWidthSpeed * 1000, t => {
        detail.style.width = startWidth + (targetWidth - startWidth) * t + 'px';
        detail.style.marginRight = startMargin + (targetMargin - startMargin) * t + 'px';
        detail.style.borderBottomLeftRadius = `${8 * (1 - t)}px`;
        detail.style.borderBottomRightRadius = `${8 * (1 - t)}px`;
      });
      const targetHeight = content.scrollHeight;
      content.style.height = '0px';
      await animate(spoilerHeightSpeed * 1000, t => content.style.height = (targetHeight * t) + 'px');
      content.style.height = 'auto';
      if (!content.contains(bottomCollapse)) content.appendChild(bottomCollapse);
    }

    animating = false;
  });

  window.addEventListener('resize', updateOpenStyles);
});

</script>

</body>
</html>
